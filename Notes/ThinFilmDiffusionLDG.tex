\documentclass[11pt, oneside]{article}
\usepackage[letterpaper, margin=2cm]{geometry}
\usepackage{Notes}

\begin{document}
\begin{center}
\textbf{\Large{Local Discontinuous Galerkin Method for Thin Film Diffusion
}}
\end{center}

  We would like to solve the 1D thin film diffusion equation with a Discontinuous
  Galerkin Method.
  The equation is given as
  \[
    q_t = - \p{q^3 q_{xxx}}_x.
  \]

\textbf{\large{Local Discontinuous Galerkin Method}}
  First rewrite the diffusion equation as a system of first order equations.
  \begin{align*}
    r &= q_x \\
    s &= r_x = q_{xx}\\
    u &= q^3 s_x = q^3 q_{xxx} \\
    q_t &= - u_x = -\p{q^3 q_{xxx}}_x
  \end{align*}

  The LDG method becomes the process of finding $q_h, r_h, s_h, u_h \in V_h$ in
  the DG solution space, such that for all test functions
  $v_h, w_h, y_h, z_h \in V_h$ and for all $j$ the following equations are
  satisfied
  \begin{align*}
    \dintt{I_j}{}{r_h w_h}{x} &= \dintt{I_j}{}{(q_h)_x w_h}{x} \\
    \dintt{I_j}{}{s_h y_h}{x} &= \dintt{I_j}{}{(r_h)_x y_h}{x} \\
    \dintt{I_j}{}{u_h z_h}{x} &= \dintt{I_j}{}{q_h^3 (s_h)_x z_h}{x} \\
    \dintt{I_j}{}{(q_h)_t v_h}{x} &= -\dintt{I_j}{}{(u_h)_x v_h}{x}
  \end{align*}
  After integrating by parts, these equations are
  \begin{align*}
    \dintt{I_j}{}{r_h w_h}{x} &= \p{\p{\hat{q}_h w^-_h}_{j+1/2} - \p{\hat{q}_j w^+_h}_{j-1/2}} - \dintt{I_j}{}{q_h (w_h)_x}{x} \\
    \dintt{I_j}{}{s_h y_h}{x} &= \p{\p{\hat{r}_h y^-_h}_{j+1/2} - \p{\hat{r}_j y^+_h}_{j-1/2}} - \dintt{I_j}{}{r_h (y_h)_x}{x} \\
    \dintt{I_j}{}{(q_h)_t v_h}{x} &= -\p{\p{\hat{u}_h v^-_h}_{j+1/2} - \p{\hat{u}_h v^+_h}_{j-1/2}} + \dintt{I_j}{}{u_h (v_h)_x}{x}
  \end{align*}
  The third equation is trickier and requires integrating by parts twice.
  \begin{align*}
    \dintt{I_j}{}{u_h z_h}{x} &= \dintt{I_j}{}{q_h^3 (r_h)_x z_h}{x} \\
    \dintt{I_j}{}{u_h z_h}{x} &= \p{\p{\hat{r}_h \hat{q_h^3} z^-_h}_{j+1/2} - \p{\hat{r}_j \hat{q_h^3} z^+_h}_{j-1/2}} - \dintt{I_j}{}{r_h (q_h^3 z_h)_x}{x} \\
    \dintt{I_j}{}{u_h z_h}{x} &= \p{\p{\hat{r}_h \hat{q_h^3} z^-_h}_{j+1/2} - \p{\hat{r}_j \hat{q_h^3} z^+_h}_{j-1/2}} \\
    &-\p{\p{\hat{r}_h \p{q^-_h}^3 z^-_h}_{j+1/2} - \p{\hat{r}_j \p{q^+_h}^3 z^+_h}_{j-1/2}} + \dintt{I_j}{}{(r_h)_x q_h^3 z_h}{x} \\
  \end{align*}

  A common choice of numerical fluxes are the so-called alternating fluxes.
  \begin{align*}
    \hat{u}_h &= u^-_h \\
    \hat{q}_h &= q^+_h \\
    \hat{r}_h &= r^-_h \\
    \hat{s}_h &= s^+_h
  \end{align*}
  or
  \begin{align*}
    \hat{u}_h &= u^+_h \\
    \hat{q}_h &= q^-_h \\
    \hat{r}_h &= r^+_h \\
    \hat{s}_h &= s^-_h
  \end{align*}

\textbf{\large{Implementation}}
  If we consider a single cell $I_j$, do a linear transformation from
  $x \in \br{x_{j-1/2}, x_{j+1/2}}$ to $\xi \in \br{-1, 1}$, and consider
  specifically the Legendre polynomial basis $\set{\phi^k(\xi)}$ with the
  following orthogonality property
  \[
    \frac{1}{2}\dintt{-1}{1}{\phi^j(\xi) \phi^k(\xi)}{\xi} = \delta_{jk}
  \]
  we can form a more concrete LDG method for implementing.
  The linear transformation can be expressed as
  \[
    x = \frac{\Delta x}{2} \xi + \frac{x_{j-1/2} + x_{j+1/2}}{2}
  \]
  or
  \[
    \xi = \frac{2}{\Delta x} \p{x - \frac{x_{j-1/2} + x_{j+1/2}}{2}}
  \]
  After this tranformation the thin film diffusion equation become
  \[
    u_t = -\frac{16}{\Delta x^4} \p{u^3 u_{\xi\xi\xi}}_{\xi}
  \]
  on the cell $I_j$.
  We can then write this as the following system of first order equations.
  \begin{align*}
    r &= \frac{2}{\Delta x} q_{\xi} \\
    s &= \frac{2}{\Delta x} r_{\xi} = \frac{4}{\Delta x^2} q_{\xi\xi} \\
    u &= \frac{2}{\Delta x} q^3 s_{\xi} = \frac{8}{\Delta x^3} q^3 q_{\xi\xi\xi} \\
    q_t &= -\frac{2}{\Delta x} u_{\xi} = - \frac{16}{\Delta x^4} \p{q^3 q_{\xi\xi\xi}}_{\xi}
  \end{align*}
  With the Legendre basis, the numerical solution on $I_j$ can be written as
  \begin{align*}
    q &\approx q_h = \sum{k = 1}{M}{Q_k \phi^k(\xi)} \\
    r &\approx r_h = \sum{k = 1}{M}{R_k \phi^k(\xi)} \\
    s &\approx s_h = \sum{k = 1}{M}{S_k \phi^k(\xi)} \\
    u &\approx u_h = \sum{k = 1}{M}{U_k \phi^k(\xi)}
  \end{align*}
  Now plugging these into the system and multiplying by a Legendre basis and integrating gives.
  \begin{align*}
    q_h &= \frac{2}{\Delta x} (u_h)_{\xi} \\
    \frac{1}{2} \dintt{-1}{1}{q_h \phi^l}{\xi} &= \frac{1}{\Delta x} \dintt{-1}{1}{(u_h)_{\xi} \phi^l}{\xi} \\
    Q_l &= -\frac{1}{\Delta x} \dintt{-1}{1}{u_h \phi^l_{\xi}}{\xi} + \frac{1}{\Delta x}\p{u^-_{j+1/2} \phi^l(1) - u^-_{j-1/2} \phi^l(-1)} \\
    (u_h)_t &= \frac{2}{\Delta x} (q_h)_{\xi} \\
    \frac{1}{2}\dintt{-1}{1}{(u_h)_t \phi^l}{\xi} &= \frac{1}{\Delta x} \dintt{-1}{1}{(q_h)_{\xi} \phi^l}{\xi} \\
    \dot{U}_l &= -\frac{1}{\Delta x} \dintt{-1}{1}{q_h \phi^l_{\xi}}{\xi} + \frac{1}{\Delta x}\p{q^+_{j+1/2} \phi^l(1) - q^+_{j-1/2} \phi^l(-1)}
  \end{align*}
  Now this is a system of ODEs, there are $M \times N$ ODEs if $M$ is the spacial
  order and $N$ is the number of cells.

%\textbf{\large{Proving Stability}}
  %In order to prove that this method is $L^2$ stable consider we sum both of the integral equations from before.
  %\begin{gather*}
    %\dintt{I_j}{}{(u_h)_t v_h}{x} + \dintt{I_j}{}{q_h w_h}{x} = \p{\p{q^+_h v^-_h}_{j+1/2} - \p{q^+_h v^+_h}_{j-1/2}} \\
    %+ \p{\p{u^-_h w^-_h}_{j+1/2} - \p{u^-_j w^+_h}_{j-1/2}} - \dintt{I_j}{}{q_h (v_h)_x}{x} - \dintt{I_j}{}{u_h (w_h)_x}{x}
  %\end{gather*}
  %Consider using $v_h = u_h$ and $w_h = q_h$.
  %\begin{gather*}
    %\dintt{I_j}{}{(u_h)_t u_h}{x} + \dintt{I_j}{}{q_h q_h}{x} = \p{\p{q^+_h u^-_h}_{j+1/2} - \p{q^+_h u^+_h}_{j-1/2}} \\
    %+ \p{\p{u^-_h q^-_h}_{j+1/2} - \p{u^-_h q^+_h}_{j-1/2}} - \dintt{I_j}{}{q_h (u_h)_x}{x} - \dintt{I_j}{}{u_h (q_h)_x}{x}
  %\end{gather*}
  %Consider the following shorthand notation
  %\begin{gather*}
    %B_j = \dintt{I_j}{}{(u_h)_t u_h}{x} + \dintt{I_j}{}{q_h q_h}{x} \\
    %B_j = \p{\p{q^+_h u^-_h}_{j+1/2} - \p{q^+_h u^+_h}_{j-1/2}} + \p{\p{u^-_h q^-_h}_{j+1/2} - \p{u^-_h q^+_h}_{j-1/2}} - \dintt{I_j}{}{q_h (u_h)_x}{x} - \dintt{I_j}{}{u_h (q_h)_x}{x}
  %\end{gather*}
  %%\begin{gather*}
    %%B_j(u_h, q_h, u_h, q_h) = \dintt{I_j}{}{(u_h)_t u_h}{x} - \p{\p{\hat{q}_h u^-_h}_{j+1/2} - \p{\hat{q}_h u^+_h}_{j-1/2}} + \dintt{I_j}{}{q_h (u_h)_x}{x} \\
    %%+ \dintt{I_j}{}{q_h q_h}{x} - \p{\p{\hat{u}_h q^-_h}_{j+1/2} - \p{\hat{u}_j q^+_h}_{j-1/2}} + \dintt{I_j}{}{u_h (q_h)_x}{x} = 0
  %%\end{gather*}
  %This can be simplified in several ways.
  %First simplify the left hand side.
  %\begin{align*}
    %B_j &= \dintt{I_j}{}{(u_h)_t u_h}{x} + \dintt{I_j}{}{q_h q_h}{x} \\
    %B_j &= \frac{1}{2} \dintt{I_j}{}{\d*{u_h^2}{t}}{x} + \dintt{I_j}{}{q_h^2}{x} \\
    %B_j &= \frac{1}{2} \d{}{t} \dintt{I_j}{}{u_h^2}{x} + \dintt{I_j}{}{q_h^2}{x} \\
    %B_j &= \frac{1}{2} \d{}{t} \norm[L^2(I_j)]{u_h}^2 + \norm[L^2(I_j)]{q_h}^2 \\
  %\end{align*}
  %Second the right hand side can be simplified.
  %\begin{align*}
    %\dintt{I_j}{}{q_h (u_h)_x}{x} + \dintt{I_j}{}{u_h (q_h)_x}{x} &= \dintt{I_j}{}{q_h (u_h)_x + u_h (q_h)_x}{x} \\
    %&= \dintt{I_j}{}{(q_h u_h)_x}{x} \\
    %&= (q^-_h u^-_h)_{j+1/2} - (q^+_h u^+_h)_{j-1/2}
  %\end{align*}
  %Now 
  %\begin{gather*}
    %B_j = \p{\p{q^+_h u^-_h}_{j+1/2} - \p{q^+_h u^+_h}_{j-1/2}} + \p{\p{u^-_h q^-_h}_{j+1/2} - \p{u^-_h q^+_h}_{j-1/2}} - \p{(q^-_h u^-_h)_{j+1/2} - (q^+_h u^+_h)_{j-1/2}} \\
    %B_j = \p{q^+_h u^-_h}_{j+1/2} - \p{u^-_h q^+_h}_{j-1/2} \\
  %\end{gather*}
  %Assuming periodic boundary conditions, and summing $B_j$ over all cells
  %\begin{align*}
    %\sum{j = 1}{N}{B_j} &= \sum{j=1}{N}{\p{q^+_h u^-_h}_{j+1/2} - \p{u^-_h q^+_h}_{j-1/2}} \\
    %&= -\p{u^-_h q^+_h}_{1/2} + \sum{k=1}{N}{\p{q^+_h u^-_h}_{k+1/2} - \p{u^-_h q^+_h}_{k+1/2}} + \p{q^+_h u^-_h}_{N+1/2} \\
    %&= 0
  %\end{align*}
  %This shows that
  %\begin{gather*}
    %\sum{j = 1}{N}{B_j} = \sum{j = 1}{N}{\frac{1}{2} \d{}{t} \norm[L^2(I_j)]{u_h}^2 + \norm[L^2(I_j)]{q_h}^2} \\
    %\frac{1}{2} \d{}{t} \norm[L^2]{u_h}^2 + \norm[L^2]{q_h}^2 = 0 \\
    %\d{}{t} \norm[L^2]{u_h}^2 \le 0
  %\end{gather*}
\end{document}
